<script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw899xcGxwayyimYfj2j-coH7z-Za_4HYByj4G6qqpFSiHl87mew2-OCLyTr_3a-baY/exec";
  const LIMITE = 25;

  async function atualizarContador() {
    try {
      const res = await fetch(SCRIPT_URL);
      const data = await res.json();

      document.getElementById("contador").innerText =
        `Participantes: ${data.total} / ${LIMITE}`;

      if (data.total >= LIMITE) {
        document.getElementById("btn").disabled = true;
        document.getElementById("msg").innerText =
          "❌ Lista encerrada. Limite atingido.";
      }
    } catch (e) {
      document.getElementById("contador").innerText =
        "Erro ao carregar contador";
    }
  }

  async function participar() {
    const nome = document.getElementById("nome").value.trim();
    const endereco = document.getElementById("endereco").value.trim();

    if (!nome || !endereco) {
      document.getElementById("msg").innerText =
        "⚠️ Preencha todos os campos.";
      return;
    }

    const body = new URLSearchParams();
    body.append("nome", nome);
    body.append("endereco", endereco);

    try {
      await fetch(SCRIPT_URL, {
        method: "POST",
        body: body
      });

      document.getElementById("msg").innerText =
        "✅ Participação confirmada!";

      document.getElementById("nome").value = "";
      document.getElementById("endereco").value = "";

      atualizarContador();
    } catch {
      document.getElementById("msg").innerText =
        "❌ Erro ao enviar. Tente novamente.";
    }
  }

  atualizarContador();
</script>